<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>todo on venndir • venndir</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css"><script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet"><script src="pkgdown.js"></script><meta property="og:title" content="todo on venndir"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-title-body">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">venndir</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.27.900</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="articles/venndir_gene_expression.html">Venndir with Gene Expression Data</a>
    </li>
  </ul></li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="http://github.com/jmw86069/venndir/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
    <div class="page-header">
      <h1>todo on venndir</h1>
    </div>

<div id="todo-on-venndir" class="section level1">

<div class="section level2">
<h2 id="id_01may2023">01may2023<a class="anchor" aria-label="anchor" href="#id_01may2023"></a></h2>
<p><strong>Note the official TODO was moved to <code>TODO.md</code>.</strong></p>
</div>
<div class="section level2">
<h2 id="id_03apr2023">03apr2023<a class="anchor" aria-label="anchor" href="#id_03apr2023"></a></h2>
<ul><li>check build issues on R-4.2.3, dependency on data.table</li>
</ul></div>
<div class="section level2">
<h2 id="id_06feb2023">06feb2023<a class="anchor" aria-label="anchor" href="#id_06feb2023"></a></h2>
<ul><li><p>add <code>venndir_legend()</code> to summarize number of elements per Venn set.</p></li>
<li>
<p><code><a href="reference/venndir.html">venndir()</a></code></p>
<ul><li>
<p>consider alternative label layouts:</p>
<ul><li>position “overlap title” at top-center</li>
<li>one column underneath when <code>overlap_type="overlap"</code> with counts</li>
<li>two columns underneath, total counts on left, signed counts on right</li>
<li>or one column with counts, then signed counts in the same column</li>
</ul></li>
<li>
<p>output really needs to be its own object type</p>
<ul><li>convert from <code>list</code> to something like <code>class="venndir_output"</code> which inherits from <code>list</code>, or is an S4 object with proper methods.</li>
<li>input to functions like <code><a href="reference/nudge_venndir_label.html">nudge_venndir_label()</a></code> should take a proper object instead of <code>list</code>.</li>
</ul></li>
<li><p>make it clear how to display overlap titles, e.g. <code>set="all"</code> is not working. The <code>x$label_df[,"overlap"]</code> column accepts <code>"outside"</code>, <code>"inside"</code>, or <code>"none"</code>, and is not being filled correctly.</p></li>
<li><p><code>plot_warning=TRUE</code> when the label contains more than 3 overlap sets, it should just indicate the number of overlap sets rather than list each overlap set.</p></li>
</ul></li>
<li>
<p>DONE. scale default <code>padding</code> value based upon <code>font_cex</code></p>
<ul><li>DONE. currently <code>padding="4 pt"</code> is too much when the font is shrunk down small</li>
<li>DONE. <code>padding</code> should be an argument to <code><a href="reference/venndir.html">venndir()</a></code>
</li>
</ul></li>
<li>
<p>add option for custom label placement?</p>
<ul><li>this option might not be needed if label orientation can be customized, e.g. with title centered above all count labels underneath it, instead of being offset.</li>
<li>center by label box</li>
<li>center by coordinate zero (the point between left/right columns in labels)</li>
</ul></li>
<li>
<p><code><a href="reference/nudge_venndir_label.html">nudge_venndir_label()</a></code></p>
<ul><li>add proper function parameter documentation</li>
<li>
<code>x_offset</code>, <code>y_offset</code> should be additive to existing values</li>
<li>should be possible to set a label <code>"inside"</code>, <code>"outside"</code>
</li>
<li>should be possible to set the overlap title <code>"inside"</code>, <code>"outside"</code>.</li>
</ul></li>
<li><p>error with <code>label_style="shaded"</code> from <code><a href="https://rdrr.io/pkg/colorjam/man/blend_colors.html" class="external-link">colorjam::blend_colors()</a></code> likely caused by blending NA or NULL colors. See <code>colorjam-blendcolors.R</code> line 161.</p></li>
<li>
<p>store more data inside <code><a href="reference/venndir.html">venndir()</a></code> output object</p>
<ul><li>Main goal is for <code>render_vendir()</code> to be totally self-sufficient when operating on <code><a href="reference/venndir.html">venndir()</a></code> output.</li>
<li>Essentially all new parameters used in <code><a href="reference/render_venndir.html">render_venndir()</a></code> should be stored in the object, for example: <code>plot_warning</code>
</li>
</ul></li>
<li>
<p>label segments</p>
<ul><li>the segment buffer should use a scale relative to the plot scale (e.g. 1% of the overall plot layout range), however when the polygon cannot accommodate that buffer, it should use progressively smaller scale relative to that polygon.</li>
</ul></li>
<li>
<p>outside label positions</p>
<ul><li>ideally during rendering, labels should be “dodged” in some way to minimize overlaps.</li>
</ul></li>
</ul></div>
<div class="section level2">
<h2 id="id_20oct2022">20oct2022<a class="anchor" aria-label="anchor" href="#id_20oct2022"></a></h2>
<ul><li>
<p><code><a href="reference/venndir.html">venndir()</a></code> possible bug</p>
<ul><li>when displaying <code>proportional=TRUE, overlap_type="overlap"</code> it does not indicate when a non-overlap cannot be displayed, for example items unique to one set. Found with 4-way Euler diagram.</li>
<li>Appears to happen sometimes when eulerr returns circular instead of ellipse shape, which seems to happen due to internal randomness.</li>
</ul></li>
<li>
<p><code>min_count</code> should be stored in <code>mem</code> output</p>
<ul><li>
<code>mem_enrichment_heatmap()</code> uses <code>min_count</code> with <code>p_cutoff</code> to define significant pathways</li>
<li>
<code>mem_plot_folio</code> has no argument <code>min_count</code> and cannot get it from <code>mem</code>
</li>
<li>
<code>multiEnrichMap()</code> should store <code>min_count</code> in the output <code>mem</code>
</li>
</ul></li>
<li>
<p>new S4 classes</p>
<ul><li>
<code>mem</code>: required for Bioconductor submission (if pursued), and useful otherwise</li>
<li>
<code>mpf</code>: or <code>mem_plots</code> or <code>mem_folio</code> with output from <code>mem_plot_folio()</code>
</li>
</ul></li>
<li>
<p><code>mem_enrichment_heatmap()</code></p>
<ul><li>apparent bug when trying to order rows to match the order in <code>mem_gene_path_heatmap()</code> - but a “bug” because it is unsupported, but it does cause incorrect heatmaps when using <code>ComplexHeatmap::draw(hm[row_index,])</code>.</li>
<li>When supplied with <code>row_order</code> this function should properly order by <code>names(row_order)</code> to match the actual <code>rownames(enrichIM)</code> used for the heatmap.</li>
<li>argument <code>min_count</code> is not explicitly passed by <code>mem_plot_folio()</code> and not stored in the <code>mem</code> object.</li>
</ul></li>
<li><p>Keep track of this URL for installation issues in Mac OSX regarding sf: <a href="https://github.com/r-spatial/sf/issues/1536#issuecomment-727342736" class="external-link uri">https://github.com/r-spatial/sf/issues/1536#issuecomment-727342736</a></p></li>
</ul></div>
<div class="section level2">
<h2 id="id_20sep2022">20sep2022<a class="anchor" aria-label="anchor" href="#id_20sep2022"></a></h2>
<ul><li><p><code>overlap_type="agreement"</code> should hide agreement for single-set overlap.</p></li>
<li>
<p>when overlap and signed overlap are displayed together, the label should center the main overlap number, with signed labels off to the side.</p>
<ul><li>Currently, main overlap and signed overlap are combined into one box, the box is centered on the label coordinate. However, inside a polygon sometimes the main overlap number is offset outside the polygon, and the signed overlap numbers are also offset, so really no numeric labels are positioned well. By default the main overlap number should be inside the polygon.</li>
</ul></li>
<li>
<p>Design idea: nudge label by overlap name.</p>
<ul><li>The idea is to make it easy to adjust a label.</li>
<li>Something like this:</li>
</ul><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nudge_label</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>   `A&amp;B`<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>x<span class="op">=</span><span class="fl">1</span>, y<span class="op">=</span><span class="fl">0</span><span class="op">)</span>,</span>
<span>   `A&amp;B&amp;C`<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>x<span class="op">=</span><span class="fl">0.5</span>, y<span class="op">=</span><span class="fl">0</span><span class="op">)</span>,</span>
<span>   `B`<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>x<span class="op">=</span><span class="fl">0</span>, y<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</li>
</ul></div>
<div class="section level2">
<h2 id="id_01sep2022">01sep2022<a class="anchor" aria-label="anchor" href="#id_01sep2022"></a></h2>
<ul><li>
<p>Small bug fix:</p>
<ul><li>
<code>overlap_type="overlap"</code>,</li>
<li>
<code>label_preset="main items"</code>,</li>
<li><code>show_items="sign item"</code></li>
<li>It displays the counts instead of the sign, since there is no sign when <code>overlap_type="overlap"</code>.</li>
<li>when <code>overlap_type="overlap"</code>, the <code>show_items</code> argument should ignore <code>"sign"</code> as a possible display value.</li>
</ul></li>
<li>
<p><code><a href="reference/signed_overlaps.html">signed_overlaps()</a></code> should default to non-signed overlaps when all entries in <code>setlist</code> have incidence value <code>1</code>, <code>"up"</code>.</p>
<ul><li>when <code>setlist</code> is an overlap list, convert with <code><a href="reference/overlaplist2setlist.html">overlaplist2setlist()</a></code> to <code>setlist</code>.</li>
</ul></li>
<li>
<p>Conversion functions, and inputs should be more user-friendly:</p>
<ul><li><p><code><a href="reference/signed_overlaps.html">signed_overlaps()</a></code> argument <code>setlist</code> should accept output from <code>label_df$items</code>.</p></li>
<li>
<p><code><a href="reference/counts2setlist.html">counts2setlist()</a></code> and <code><a href="reference/signed_counts2setlist.html">signed_counts2setlist()</a></code> should accept the names from <code>lengths(label_df$items)</code>, which includes a suffix with the overlap hit values.</p>
<ul><li>For example, names include: <code>"GroupA|1 0", "GroupB|0 1", "GroupA&amp;GroupB|1 1"</code>. Simple enough, they should be equivalent to: <code>"GroupA", "GroupB", "GroupA&amp;GroupB"</code>.</li>
<li>Also, for signed overlaps, the suffix indicates the direction, and should be honored.</li>
</ul></li>
</ul></li>
</ul></div>
<div class="section level2">
<h2 id="id_31may2022">31may2022<a class="anchor" aria-label="anchor" href="#id_31may2022"></a></h2>
<ul><li>Bug with <code><a href="reference/textvenn.html">textvenn()</a></code> caused by <code><a href="https://rdrr.io/pkg/jamba/man/printDebug.html" class="external-link">jamba::printDebug()</a></code>.</li>
</ul></div>
<div class="section level2">
<h2 id="id_23may2022">23may2022<a class="anchor" aria-label="anchor" href="#id_23may2022"></a></h2>
<ul><li><p>Bug: <code>proportional=TRUE</code> and <code>show_items="sign item"</code> appears to cause it to position labels inside a polygon that does not exist. See venndir.R line 817 inside <code><a href="reference/render_venndir.html">render_venndir()</a></code>. Error: “Error in label_xy[, 1] : subscript out of bounds” seems like a symptom of a polygon that does not exist in proportional polygons.</p></li>
<li><p>Why is there such a large gap between overlap and signed counts in the label? See if there is a padding that can be reduced in the respective ggtext labels.</p></li>
<li><p>Consider new default: <code>overlap_type="each"</code>.</p></li>
<li><p>Consider new default: <code>label_preset="main outside"</code>.</p></li>
<li><p>Consider new default: <code>inside_label_percent=0</code> or <code>1</code>.</p></li>
<li><p>Consider by default positioning labels above/below rather than radially around the plot, otherwise consider <code>expand_fraction=0.2</code>.</p></li>
<li>
<p><code>inside_label_percent</code> should use the bounding box area as the basis for the calculation, since the 4-way Venn takes up a larger percentage of the bounding box than the 3-way Venn. The theory should be the percentage of screen space available to position a label.</p>
<ul><li>Actually, “ideal world” the theory should be whether the label fits inside the Venn overlap polygon. The label bounding box will generally be larger than the actual label text, so this approach is more likely to determine labels are “too big” when they could actually fit inside the polygon.</li>
<li>Single numerical counts are most intuitive inside the polygon.</li>
<li>Signed counts are “busy” - but when they fit beside the main overlap count without overstepping the polygon, it works well.</li>
</ul></li>
</ul></div>
<div class="section level2">
<h2 id="id_15may2022">15may2022<a class="anchor" aria-label="anchor" href="#id_15may2022"></a></h2>
<ul><li>
<p>scale proportional coordinates to rough the same magnitude as non-proportional coordinate circles.</p>
<ul><li>proportional coordinates tend to have much larger (7x) magnitude</li>
<li>other downstream components are based upon absolute coordinates:</li>
<li>item_buffer, segment_buffer</li>
<li>offset</li>
</ul></li>
</ul></div>
<div class="section level2">
<h2 id="id_06may2022">06may2022<a class="anchor" aria-label="anchor" href="#id_06may2022"></a></h2>
<ul><li>
<p>adjust item label size <code>item_cex</code> automatically based upon</p>
<ol style="list-style-type: decimal"><li>number of item labels</li>
<li>relative area of the polygon</li>
</ol></li>
<li>
<p><code><a href="reference/venndir.html">venndir()</a></code> and <code><a href="reference/render_venndir.html">render_venndir()</a></code> should have specific argument for the item label buffer width</p>
<ul><li>it currently uses <code>label_polygon_fill()</code> argument <code>scale_width</code> which is impossible to remember!</li>
</ul></li>
<li>
<p>Prepare some easy way to enable Venn diagrams from <code>sestats</code> results from <code><a href="https://rdrr.io/pkg/jamses/man/se_contrast_stats.html" class="external-link">jamses::se_contrast_stats()</a></code>.</p>
<ul><li>Consider something similar for <code><a href="https://rdrr.io/pkg/limma/man/decideTests.html" class="external-link">limma::decideTests()</a></code> which returns an incidence matrix.</li>
<li>Consider allowing incidence matrix as valid input to <code><a href="reference/venndir.html">venndir()</a></code>.</li>
<li>While we’re at it, try to recognize other common inputs, such as signed count vector, count vector, incidence matrix, signed incidence matrix.</li>
</ul></li>
</ul><div class="section level3">
<h3 id="convert-from-spatialpolygonsdataframe-to-sf-equivalent">Convert from SpatialPolygonsDataFrame to sf equivalent<a class="anchor" aria-label="anchor" href="#convert-from-spatialpolygonsdataframe-to-sf-equivalent"></a></h3>
<p>Background:</p>
<ul><li><p>The <code>sp</code> package is deprecated, to be retired by end of 2023.</p></li>
<li><p>All <code>sp</code> methods must be converted to use <code>sf</code> format.</p></li>
<li><p>Fortunately, <code>sf</code> uses something like a <code>data.frame</code> as its storage model for polygons. Most if not all functions from <code>rgeos</code> are already available as <code>sf</code>-specific functions, the steps just all need to be ported.</p></li>
<li>
<p>Unsure if <code>spsample</code> is available for <code>sf</code>. It would not be too difficult to wrapper a very simple replacement function:</p>
<ul><li>start with square coordinate “grid”</li>
<li>rotate grid 30, 45, or 60 degrees</li>
<li>overlay grid onto polygon P</li>
<li>resize grid progressively smaller until at least N points are inside P</li>
<li>optionally perform basic rotations at each sizing to maximize fit</li>
</ul></li>
</ul></div>
</div>
<div class="section level2">
<h2 id="id_28apr2022">28apr2022<a class="anchor" aria-label="anchor" href="#id_28apr2022"></a></h2>
<ul><li><p><code><a href="reference/render_venndir.html">render_venndir()</a></code> does not honor <code>show_segments=FALSE</code> with <code>plot_style="gg"</code>.</p></li>
<li>
<p>In the rare case that two sets completely overlap, proportional Euler returns two identical circles. We should probably offset them at least 1% so the circle colors are visible.</p>
<ul><li>
<code><a href="reference/venndir.html">venndir()</a></code> obtains the proportional coordinates, <code><a href="reference/get_venn_shapes.html">get_venn_shapes()</a></code> creates the coordinates - the step that creates coordinates should probably test and do the adjustment, so any function that calls <code><a href="reference/get_venn_shapes.html">get_venn_shapes()</a></code> will receive valid coordinates.</li>
</ul></li>
<li>
<p>Problem: proportional Venn labels outside are not placed in ideal locations:</p>
<ul><li>often placed left and right side, which extend beyond the panel width</li>
<li>sometimes still overlap other labels placed outside, partly due to irregular label “box”, wide text labels, multi-line text labels, multi-component labels (set name, counts, signed counts)</li>
</ul></li>
<li><p>Need a method to display overlap count and item labels in a set.</p></li>
<li><p>When item labels exceed <code>max_items</code> it should display the overlap counts, currently it displays nothing.</p></li>
<li>
<p>Need a method to display set sizes somewhere in the plot panel:</p>
<ul><li>Total items in each set.</li>
<li>Total items overall.</li>
</ul></li>
<li>
<p>Need method to display overlap percent as alternative to overlap count</p>
<ul><li>How do other Venn diagram tools calculate percent overlap?</li>
</ul></li>
</ul></div>
<div class="section level2">
<h2 id="id_09mar2022">09mar2022<a class="anchor" aria-label="anchor" href="#id_09mar2022"></a></h2>
<ul><li>
<code><a href="reference/textvenn.html">textvenn()</a></code> is useful but sometimes labels are super long and fill the screen width (and beyond). It needs some logic to word-wrap. E.g. wrap by the separator <code>"&amp;"</code> as first-pass; potentially word-wrap each label within that if longer than a defined length. Word-wrap probably needs to be sensitive to underscores “_“, hyphens”-“, period”.”, and whitespace ” “, including things like”“, etc.</li>
</ul></div>
<div class="section level2">
<h2 id="id_02feb2022">02feb2022<a class="anchor" aria-label="anchor" href="#id_02feb2022"></a></h2>
<ul><li>Option to supply specific SpatialPolygons objects for each set.</li>
<li>Option to apply <code>rotate_degrees</code> to the polygon representing specific sets. The function <code><a href="reference/rescale_sp.html">rescale_sp()</a></code> takes <code>rotate_degrees</code> as an argument then applies to all polygons. It could potentially be applied to named polygons, if <code>rotate_degrees</code> also had names that matched the sp object.</li>
</ul></div>
<div class="section level2">
<h2 id="id_30jan2022">30jan2022<a class="anchor" aria-label="anchor" href="#id_30jan2022"></a></h2>
<div class="section level3">
<h3 id="bugs-observed">Bugs observed<a class="anchor" aria-label="anchor" href="#bugs-observed"></a></h3>
<ul><li>Sometimes <code>label_style="shaded box"</code> throw error and do not display.</li>
<li>Sometimes <code>label_preset="main outside"</code> causes main labels not to be plotted. The inside labels appear correctly.</li>
<li>Proportional Venn labels draw a segment to an ambiguous polygon, sometimes two segments end inside the same polygon.</li>
</ul></div>
<div class="section level3">
<h3 id="feature-enhancements">Feature enhancements<a class="anchor" aria-label="anchor" href="#feature-enhancements"></a></h3>
<ul><li>
<p><code><a href="reference/venndir.html">venndir()</a></code> option to “recognize” when the input is format:</p>
<ul><li>incidence matrix: <code><a href="reference/im2list.html">im2list()</a></code>
</li>
<li>signed incidence matrix: <code><a href="reference/im_value2list.html">im_value2list()</a></code>
</li>
<li>overlap counts: <code><a href="reference/counts2setlist.html">counts2setlist()</a></code>; force <code>return_items=FALSE</code>
</li>
<li>signed overlap counts: <code><a href="reference/signed_counts2setlist.html">signed_counts2setlist()</a></code>; force <code>return_items=FALSE</code>
</li>
</ul></li>
<li>
<p>Option to supply a list where some elements are signed, while others are not. For example, supplying “dysregulated genes” with direction, and supplying “genes assayed” which is not directional. This feature implies certain downstream effects:</p>
<ul><li>Concordance cannot be confirmed or denied with non-directional list elements. For example, “gene hit down”, “protein hit down”, “protein assayed” should be reported as “concordant”, and the label should be something like “downArrow hyphen downArrow”.</li>
</ul></li>
<li>
<p>Need more/better styles for arranging labels.</p>
<ul><li>Option to center set name above the counts and signed counts.</li>
<li>Option for multi-column signed counts, especially for 3+ signed sets.</li>
</ul></li>
</ul></div>
</div>
<div class="section level2">
<h2 id="id_15nov2021">15nov2021<a class="anchor" aria-label="anchor" href="#id_15nov2021"></a></h2>
<ul><li><p>indicate total items per set somewhere in the figure</p></li>
<li>
<p>different label layout strategies, for example:</p>
<ul><li>The main set label is placed top-left, main counts bottom-left, signed counts placed top-right through bottom-right. The label width is calculated and centered inside the Venn polygon, however the counts are sometimes pushed to the far right if the main set label is too long.</li>
<li>Alternative is to place set label top-center, then main count labels bottom-left, signed counts bottom-right.</li>
</ul></li>
</ul></div>
<div class="section level2">
<h2 id="id_02nov2021">02nov2021<a class="anchor" aria-label="anchor" href="#id_02nov2021"></a></h2>
<ul><li>
<p>proportional Venn label positioning bugs:</p>
<ul><li>when a circle is fully inside another, it tries to label the interior circle using the polygon with fewest overlaps; however it errantly tries to place the count label for the unique set also inside the polygon which is obviously incorrect.</li>
<li>it would be good to re-draw Venn circles using the actual set color after everything is rendered - to help reinforce the set colors</li>
</ul></li>
<li>
<p>“Try harder to make Euler proportional Venn diagram layout that represents all overlaps.” A related issue was filed until R “eulerr” Github here: <a href="https://github.com/jolars/eulerr/issues/84" class="external-link uri">https://github.com/jolars/eulerr/issues/84</a></p>
<ul><li>basic idea is to manipulate the algorithm <code>eulerr/src/optim_final.cpp</code> lines 125 to 131. Example code is shown that adjusts the scoring.</li>
<li>The current approach ranks solutions by lowest residual of <code>fitted_area - orig_area</code> - in other words absolute area represented. My thought was to add an “area penalty” when an entire overlap is not represented - this penalty could be a percentage of the total counts that are not represented multiplied by a weighting factor, for example 5x.</li>
</ul></li>
</ul></div>
<div class="section level2">
<h2 id="id_29oct2021">29oct2021<a class="anchor" aria-label="anchor" href="#id_29oct2021"></a></h2>
<ul><li><p>Lot of examples of Venn diagram includes the percentage either along with the overlap count, or instead of the overlap count.</p></li>
<li><p>Several examples of Venn diagrams hide/display a subset of labels of interest.</p></li>
<li>
<p>Lot of venndir examples where the set label is super long, which makes the center of the label offset in a weird way.</p>
<ul><li>ideal world: have some configurable orientations of labels to include in each cell.</li>
<li>one example: set title is centered across the label, the overlap and signed overlaps all appear below this title.</li>
</ul></li>
</ul></div>
<div class="section level2">
<h2 id="id_01oct2021">01oct2021<a class="anchor" aria-label="anchor" href="#id_01oct2021"></a></h2>
<ul><li>
<p>Make <code><a href="reference/curate_venn_labels.html">curate_venn_labels()</a></code> options more clearly defined</p>
<ul><li>the default data should be documented somewhere, perhaps as data to make it easier to customize</li>
</ul></li>
</ul></div>
<div class="section level2">
<h2 id="id_28sep2021">28sep2021<a class="anchor" aria-label="anchor" href="#id_28sep2021"></a></h2>
<ul><li><p>I cannot ever remember how to add item labels! If I cannot remember, nobody else can remember. It needs to be easy to enable.</p></li>
<li><p>Some option to word wrap super long set labels, otherwise the label is 10x wider than the plot size.</p></li>
<li><p>COMPLETE: Implement <code>max_items</code> so item labels are hidden in sections with too many labels.</p></li>
<li><p>COMPLETE: Item labels should use <code><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text()</a></code> or <code>geom_text()</code> and not the <code>gridtext()</code> and <code>geom_gridtext()</code> counterparts - they are extremely slow for even moderate (20 to 50) labels on one figure. The gridtext feature is mostly useful for markdown support, which can be optional.</p></li>
<li>
<p>It is hard to adjust placement of labels outside the circle.</p>
<ul><li>
<code>offset</code> is intended to help push labels in one direction, but does not work reliably, especially for proportional Euler diagrams. One option is to scale proportional coordinates to typical dimensions used by fixed layouts.</li>
<li>Revisit the workflow to nudge or move label positions.</li>
</ul></li>
<li>
<p>COMPLETE: <code><a href="reference/polygon_label_fill.html">polygon_label_fill()</a></code> argument <code>apply_n_scale=TRUE</code> should also adjust polygons by relative size of the polygon compared to the size of the overall Venn diagram. Smaller polygons with fewer labels should not be adjusted as much as larger polygons.</p>
<ul><li>In general, proportional diagrams should use the same buffer for each polygon, since the polygon is already proportional to the number of item labels.</li>
</ul></li>
<li><p><code><a href="reference/polygon_label_outside.html">polygon_label_outside()</a></code> should adjust relative buffer consistent with <code><a href="reference/polygon_label_fill.html">polygon_label_fill()</a></code>, based upon the plot size.</p></li>
<li>
<p>More arguments should be added to <code><a href="reference/venndir.html">venndir()</a></code> so these options are not “hidden” features:</p>
<ul><li>shape=“ellipse” is used for proportional Euler diagrams and allows elliptical ovals instead of circles.</li>
<li>
<code>scale_width</code> is passed to <code><a href="reference/polygon_label_fill.html">polygon_label_fill()</a></code> when items are being displayed.</li>
<li>
<code>draw_buffer</code> - shows item polygon buffer</li>
<li>
<code>segment_buffer</code> - adjusts segment from outside labels to respective internal polygon.</li>
<li>
<code>apply_n_scale</code> - adjusts item polygon buffer by number of labels.</li>
<li>
<code>center_method</code>, <code>vector_method</code>, <code>segment_method</code> passed to <code><a href="reference/polygon_label_outside.html">polygon_label_outside()</a></code> to position labels around the Venn polygons.</li>
</ul></li>
<li><p>Longer term, I might need to adjust the “optimization settings” used by the <code>eulerr</code> package. It appears to perform a solver minimization function that maximizes the total overlap count represented. I think it could be penalized when a set overlap is not represented to “encourage” it not to skip a potential overlap.</p></li>
</ul><div class="section level3">
<h3 id="venn-section-labeling-bugs">Venn section labeling bugs<a class="anchor" aria-label="anchor" href="#venn-section-labeling-bugs"></a></h3>
<ul><li><p>Problem: sometimes an outside label points to wrong polygon inside the Venn diagram. Seems limited to proportional Euler diagrams.</p></li>
<li>
<p>It appears the priority in selecting a polygon is sorted wrong, for example, it should pick the subsection with fewest overlapping sets. It seems to choose the whole Venn circle instead of a subsection.</p>
<ul><li>A main set label outside may have a segment that points to some arbitrary location.</li>
<li>Sometimes an overlap count appears in a random location, and it appears to be “buggy”. Sometimes the overlap count should be hidden; other times the overlap count is in the wrong location.</li>
</ul></li>
<li>
<p>Change <code><a href="reference/render_venndir.html">render_venndir()</a></code> to draw each Venn set border after the individual polygons have been drawn, but before the labels have been added. The goal is for the Venn set borders to match <code>set_colors</code>.</p>
<ul><li>Currently when a Venn circle is fully inside another circle, the two set colors are blended to produce the polygon fill and polygon border. In this case, the border does not match any value in <code>set_colors</code>.</li>
</ul></li>
</ul></div>
</div>
<div class="section level2">
<h2 id="id_25jun2021">25jun2021<a class="anchor" aria-label="anchor" href="#id_25jun2021"></a></h2>
<ul><li>when input character vectors happen to have names, <code><a href="reference/signed_overlaps.html">signed_overlaps()</a></code> should not assume directional overlap unless specifically requested, otherwise it takes ages! Workaround is to use <code>overlap_type="overlap"</code>.</li>
</ul></div>
<div class="section level2">
<h2 id="usability-of-custom-changes">usability of custom changes<a class="anchor" aria-label="anchor" href="#usability-of-custom-changes"></a></h2>
<ul><li>document using <code>offset</code> so outside labels can be influenced up or down, left or right in a figure.</li>
</ul></div>
<div class="section level2">
<h2 id="low-usability-for-item-labeling">low usability for item labeling<a class="anchor" aria-label="anchor" href="#low-usability-for-item-labeling"></a></h2>
<ul><li>It’s too confusing to add item labels to the diagram, it needs to be more “automatic” so that when <code>show_items</code> is enabled, <code>label_preset</code> is updated consistently. Also <code>label_preset</code> needs to be visible in <code><a href="reference/venndir.html">venndir()</a></code> and <code><a href="reference/render_venndir.html">render_venndir()</a></code> instead of being passed via <code>...</code>.</li>
<li>Item labels using <code>ggtext</code> and <code>gridtext</code> are PAINFULLY slow to render more than 100 or so labels. Slow in terms of minutes, compared to the expected sub-second response time. Maybe the developers are okay with that, but there is no big reason not to use something orders of magnitude faster in venndir… like <code><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text()</a></code> and <code>geom_text()</code>. It means item labels cannot contain markdown, unless we allow ggtext and gridtext as an option, like for <code><a href="reference/venn_meme.html">venn_meme()</a></code> when there is usually only one item per overlap. Using <code><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text()</a></code> and <code>geom_text()</code> may impact the font and Unicode compatibility of displaying arrows (again).</li>
</ul></div>
<div class="section level2">
<h2 id="new-label-preset">new label preset<a class="anchor" aria-label="anchor" href="#new-label-preset"></a></h2>
<ul><li>set label and count inside, signed labels outside</li>
</ul></div>
<div class="section level2">
<h2 id="usability-of-custom-label-placement">usability of custom label placement<a class="anchor" aria-label="anchor" href="#usability-of-custom-label-placement"></a></h2>
<ul><li>Use case: move one overlap label inside, another label outside the polygon.</li>
<li>Use case: move the signed labels for one overlap outside, but keep set and main count label inside.</li>
</ul></div>
<div class="section level2">
<h2 id="bugs">bugs<a class="anchor" aria-label="anchor" href="#bugs"></a></h2>
<ul><li><p>When set label is supposed to be inside, but there is no portion of the circle unique to that set label, the label seems to go near a border. However, it often overlaps the count label, and maybe should be grouped with the largest internal polygon overlap for that set.</p></li>
<li><p>Item labels ignores the argument <code>max_items</code> and should instead hide item labels and display numeric counts when the number of items is too high.</p></li>
<li><p>Sometimes with 4-way proportional Venn diagrams the main set label seems to point to the whole circle, instead of pointing to the subset of the circle that is specific to the label. Something seems to be going wrong when choosing the best available polygon to direct the label. It appears to work for intersect polygons, but not for main set labels, which suggests the order of choosing a polygon when more than one has a matching label is the problem – and this should only happen with main labels because they are associated with the full circle, and with any overlap polygon that only involves that same label.</p></li>
<li><p>Item label <code>buffer_w</code> and <code>buffer_h</code> appear to use absolute plot units instead of relative units. Since proportional coordinates tends to be different range than the fixed Venn circles, the units are not interchangable, making it confusing. Also, these buffers should be apparent in <code><a href="reference/venndir.html">venndir()</a></code> and <code><a href="reference/render_venndir.html">render_venndir()</a></code> rather than being hidden inside <code>...</code>.</p></li>
<li><p>COMPLETE: If input contains <code>factor</code> values, they are coerced to <code>integer</code> which is incorrect. It needs to convert to <code>character</code> then follow the proper steps.</p></li>
</ul></div>
<div class="section level2">
<h2 id="vignette-on-fonts">vignette on fonts<a class="anchor" aria-label="anchor" href="#vignette-on-fonts"></a></h2>
<p>From user testing and feedback, there are issues around font display. For example, <code><a href="https://rdrr.io/r/grDevices/pdf.html" class="external-link">pdf()</a></code> output sometimes displays no text labels, while <code><a href="https://rdrr.io/r/grDevices/png.html" class="external-link">png()</a></code> does display the text labels. We think this issue is due to the <code>fontfamily</code> argument and/or <code>family</code> parameter referencing a font that is not present on the user environment.</p>
<p>R fonts are sort of a nightmare. There are fonts for several different output devices, and they are not always consistent.</p>
<p>Choosing a font that does not represent Unicode characters will result in directional arrows being shown as blank squares, something like <code>[]</code>. This issue is usually caused by one or two issues:</p>
<ul><li>Font does not include Unicode symbols at all.</li>
<li>R locale does not permit Unicode characters.</li>
</ul><p>Both the above must be valid for Unicode arrows to be displayed.</p>
<p>The vignette should describe several different scenarios and potential workarounds. Include example with Cairo package and <code>CairoFonts()</code>.</p>
</div>
<div class="section level2">
<h2 id="enhancements">enhancements<a class="anchor" aria-label="anchor" href="#enhancements"></a></h2>
<div class="section level3">
<h3 id="visual-issue">visual issue<a class="anchor" aria-label="anchor" href="#visual-issue"></a></h3>
<p>Currently the main count label font is always the same color as the main set label font, even when the main set label is outside and the main count label is inside the polygon. Visually this is only a problem when the polygon fill is a dark color, and the outside background is a light color (usually white). When this happens, the count label inside the polygon is black on a dark color, and is very difficult to read.</p>
<p>The best current workaround is to use <code>poly_alpha=0.2</code> which should force the Venn fill to be pale enough that black labels are clearly visible.</p>
<p>A refactor is required to store the main set name label color separate from the main count label. This change can be done two ways:</p>
<ol style="list-style-type: decimal"><li>adding a row in <code>label_df</code>, which will also allow specifying the set name fill and box independent from the count fill and box.</li>
<li>adding a column to <code>venn_spdf</code> for font color, note this step does not allow the outside set name label to have different fill and box outline than the inside count label, if desired.</li>
</ol><p>Looks like option 1 is preferable.</p>
</div>
<div class="section level3">
<h3 id="bugs-1">bugs<a class="anchor" aria-label="anchor" href="#bugs-1"></a></h3>
<ul><li>
<code><a href="reference/render_venndir.html">render_venndir()</a></code> argument <code>max_items</code> is being ignored. For overlaps with too many items, desired behavior is to display the counts instead of item labels.</li>
<li>
<code><a href="reference/polygon_label_outside.html">polygon_label_outside()</a></code> is glitchy for weird proportional cases, for example 4 sets and <code>shape="ellipse"</code> might warrant different default settings. Alternative method would involve taking boundary point, expanding the boundary, find nearest point on that boundary, then proceeding with <code><a href="reference/spread_degrees.html">spread_degrees()</a></code>.</li>
</ul></div>
<div class="section level3">
<h3 id="performance">performance<a class="anchor" aria-label="anchor" href="#performance"></a></h3>
<ul><li>Showing a few hundred item labels is still painfully slow. Consider <code><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text()</a></code> as an alternative. Or test options that remove the dither options for color/degrees/cex in case that somehow triggers non-vectorized rendering.</li>
<li>
<code><a href="reference/polygon_label_outside.html">polygon_label_outside()</a></code> for 5-way Venn overlaps sometimes moves labels to weird positions. Workaround with <code>min_degrees=8</code> but not sure why.</li>
</ul></div>
<div class="section level3">
<h3 id="miscellaneous">miscellaneous<a class="anchor" aria-label="anchor" href="#miscellaneous"></a></h3>
<ul><li>Option to display concordance score below the signed values.</li>
<li>For <code>overlap_type="agreement"</code> hide the signed values for single-set overlaps, they always “agree” and are not informative.</li>
</ul></div>
<div class="section level3">
<h3 id="prepare-for-r-shiny">prepare for R-shiny<a class="anchor" aria-label="anchor" href="#prepare-for-r-shiny"></a></h3>
<ul><li>
<p>make <code><a href="https://wilkelab.org/ggtext/reference/geom_textbox.html" class="external-link">ggtext::geom_textbox()</a></code> and <code><a href="https://wilkelab.org/ggtext/reference/geom_richtext.html" class="external-link">ggtext::geom_richtext()</a></code> work for <code><a href="https://rdrr.io/pkg/plotly/man/ggplotly.html" class="external-link">plotly::ggplotly()</a></code>, by adding <code>to_basic.*()</code> functions. For example, in the package <code>splicejam</code> to make <code><a href="https://ggforce.data-imaginist.com/reference/geom_shape.html" class="external-link">ggforce::geom_shape()</a></code> work, I added the function <code>to_basic.GeomShape()</code>.</p>
<ul><li><code><a href="reference/to_basic.GeomRichText.html">to_basic.GeomRichText()</a></code></li>
<li><code><a href="reference/to_basic.GeomTextBox.html">to_basic.GeomTextBox()</a></code></li>
</ul></li>
</ul></div>
</div>
<div class="section level2">
<h2 id="fixed-bugs-version-00119000">fixed bugs version 0.0.11.9000<a class="anchor" aria-label="anchor" href="#fixed-bugs-version-00119000"></a></h2>
<ul><li><p>FIXED: <code><a href="reference/im2list.html">im2list()</a></code> with logical matrix input was incorrectly assigning all values. The <code>empty</code> argument will match the class of the input <code>x</code> to account for this mismatch.</p></li>
<li><p>FIXED: <code>show_zero=TRUE</code> is not working properly, it is always hidden.</p></li>
<li><p>FIXED: <code>alpha_by_counts</code> appears to be mis-aligned.</p></li>
<li><p>FIXED: Fix issue where directional label colors apply <code><a href="reference/make_color_contrast.html">make_color_contrast()</a></code> without using the correct <code>alpha</code> value. See with <code>venndir(make_venn_test(100, 3), poly_alpha=0)</code></p></li>
<li><p>DONE: Add warning message to ggplot2 output in <code><a href="reference/render_venndir.html">render_venndir()</a></code>.</p></li>
</ul></div>
<div class="section level2">
<h2 id="vignettes">vignettes<a class="anchor" aria-label="anchor" href="#vignettes"></a></h2>
<div class="section level3">
<h3 id="interfacing-with-venndetail">interfacing with VennDetail<a class="anchor" aria-label="anchor" href="#interfacing-with-venndetail"></a></h3>
<ul><li>follow VennDetail vignette, show alternative with directional changes</li>
</ul></div>
<div class="section level3">
<h3 id="interfacing-with-deseq2edger">interfacing with DESeq2/edgeR<a class="anchor" aria-label="anchor" href="#interfacing-with-deseq2edger"></a></h3>
</div>
<div class="section level3">
<h3 id="add-vignette-showing-more-visual-options">add vignette showing more visual options<a class="anchor" aria-label="anchor" href="#add-vignette-showing-more-visual-options"></a></h3>
<ul><li>how to change Venn set colors</li>
<li>how to nudge a Venn circle</li>
<li>how to rotate the whole Venn diagram</li>
<li>how to adjust item label buffer, and view the buffer size</li>
<li>how to create custom curations with <code>curate_df</code>
</li>
<li>how to handle gene data in a dataset with multiple probes per gene</li>
</ul></div>
<div class="section level3">
<h3 id="make-displaying-items-labels-easier">make displaying items labels easier<a class="anchor" aria-label="anchor" href="#make-displaying-items-labels-easier"></a></h3>
<ul><li>make it “one step” to display items, when <code>show_items</code> is enabled in <code><a href="reference/venndir.html">venndir()</a></code> the default <code>label_preset</code> should include items.</li>
<li>Option to allow “one column” of labels inside the polygon, which could be useful for things like a list of pathways between two experiments.</li>
</ul></div>
<div class="section level3">
<h3 id="polish-label-coordinates-insideoutside">polish label coordinates inside/outside<a class="anchor" aria-label="anchor" href="#polish-label-coordinates-insideoutside"></a></h3>
<ul><li>coordinates for inside/outside should really just be in <code>venn_spdf</code> then used by <code>label_df</code> when needed</li>
<li>label styles need polishing. If overlap label is outside and count label is inside, how can they have two different styles?</li>
</ul></div>
<div class="section level3">
<h3 id="combine-individual-labels-into-one-cohesive-label">Combine individual labels into one cohesive label<a class="anchor" aria-label="anchor" href="#combine-individual-labels-into-one-cohesive-label"></a></h3>
<p>COMPLETE for base R plots. * TODO: for any label associated with a line segment, use <code>degree_to_adj()</code> to help place the label at the correct edge of the line segment. * one option is simply to create one label, but text alignment for two column output would be difficult. * prototype using one label for fill/border, and expand the buffer size so it includes the other labels.</p>
<ul><li>calculate label width/height (<code><a href="https://rdrr.io/r/grid/widthDetails.html" class="external-link">grid::ascentDetails()</a></code>, <code><a href="https://rdrr.io/r/grid/widthDetails.html" class="external-link">grid::widthDetails()</a></code>
</li>
<li>also use grid graphics logic to use rescalable operations</li>
<li>requires knowledge about grid graphics I don’t currently have and was not yet easy to grok from online guides. I was able to proof-of-concept a method that used grob dimensions of a left label, to produce a right label with border and padding sufficient to encompass both sides. When trying to automate, it stopped working. Something in the circular logic, that a grob does not have a size until placed, so adjusting by size before placement has no usable value?</li>
</ul></div>
</div>
<div class="section level2">
<h2 id="done-update-rmarkdown-readmermd-and-venndir_gene_expressionrmd">DONE: Update Rmarkdown README.Rmd and venndir_gene_expression.Rmd<a class="anchor" aria-label="anchor" href="#done-update-rmarkdown-readmermd-and-venndir_gene_expressionrmd"></a></h2>
<ul><li>Use new recommended workflow and function arguments.</li>
<li>Beware errors in <code>venndir_gene_expression.Rmd</code> with unique errors related to <code>ragg_png</code>, see details and workaround suggested here: <a href="https://www.jumpingrivers.com/blog/r-knitr-markdown-png-pdf-graphics/" class="external-link uri">https://www.jumpingrivers.com/blog/r-knitr-markdown-png-pdf-graphics/</a>
</li>
</ul></div>
<div class="section level2">
<h2 id="done-small-features-for-version-0099000">DONE: small features for version 0.0.9.9000<a class="anchor" aria-label="anchor" href="#done-small-features-for-version-0099000"></a></h2>
<ul><li>
<p>DONE: Some importer for signed overlaps. Given a known directional Venn, have a method to import to use venndir.</p>
<ul><li><code><a href="reference/signed_counts2setlist.html">signed_counts2setlist()</a></code></li>
</ul></li>
<li><p>DONE: Bug: Fix <code><a href="https://jolars.github.io/polylabelr//reference/poi.html" class="external-link">polylabelr::poi()</a></code> when there is one or more holes inside a polygon.</p></li>
<li><p>DONE: change all arguments with <code>angle</code> to use <code>degrees</code> for consistency, and to make clear the type of angle.</p></li>
<li>
<p>DONE: Refactor to handle <code>"set name"</code> separate from <code>"main count"</code> in the count label, so the <code>"set name"</code> can be moved, for example to perimeter or outside the polygon, leaving the numeric count inside as needed.</p>
<ul><li>DONE: Proportional diagram with one circle fully inside another does not have set name displayed – it must be. Consider choosing one internal polygon with fewest set overlaps with the largest area.</li>
<li>DONE: need idea for where to store the set label coordinates, since the Venn circle/ellipse shape does not have its own row.</li>
<li>DONE: maybe venn shapes need to be stored in another <code>list</code> element returned by <code><a href="reference/venndir.html">venndir()</a></code>? It makes that output a bit too heavy imo.</li>
</ul></li>
<li><p>Maybe: new function <code>venndir_bender()</code> to modify a <code>venndir</code> result. resize, move, rotate venndir circles/ellipses.</p></li>
<li><p>DONE: change default to <code>return_items=TRUE</code> for <code><a href="reference/venndir.html">venndir()</a></code> and <code><a href="reference/signed_overlaps.html">signed_overlaps()</a></code>.</p></li>
</ul><div class="section level3">
<h3 id="done-refactor-label-position">DONE: refactor label position<a class="anchor" aria-label="anchor" href="#done-refactor-label-position"></a></h3>
<p>Design idea: Four label types: set, overlap, count, items</p>
<ul><li>
<p>set</p>
<ul><li>inside</li>
<li>outside</li>
<li>none</li>
<li>ifhidden</li>
</ul></li>
<li>
<p>overlap</p>
<ul><li>none</li>
<li>inside</li>
<li>outside</li>
</ul></li>
<li>
<p>count</p>
<ul><li>inside</li>
<li>outside</li>
<li>none</li>
</ul></li>
<li>
<p>items</p>
<ul><li>none</li>
<li>inside</li>
</ul></li>
</ul><p>Data storage:</p>
<ul><li>
<p>venn_spdf</p>
<ul><li>contains each Venn circle</li>
<li>contains each Venn overlap polygon</li>
</ul></li>
<li>
<p>label_df</p>
<ul><li>contains each overlap count label</li>
</ul></li>
</ul><p>Progress:</p>
<ul><li>COMPLETE for base R plots.</li>
<li>COMPLETE for ggplot.</li>
</ul></div>
<div class="section level3">
<h3 id="done-update-polygon_label_outside-for-multiple-labels">DONE: update <code>polygon_label_outside()</code> for multiple labels<a class="anchor" aria-label="anchor" href="#done-update-polygon_label_outside-for-multiple-labels"></a></h3>
<ul><li>DONE: The idea is to position labels by angle relative to the same central point, detect labels “too close” to one another, then spread them out evenly to assist with spacing between labels.</li>
<li>Labels would be defined mainly by center point and angle in degrees.</li>
<li>“Too close” would be defined by user-configurable minimum degrees, with some suitable default value.</li>
<li>return the point of label, and the point at the polygon so a line segment can be drawn</li>
<li>return the text adjust (<code>adj</code>) value so a text label can be placed at an appropriate side relative to the incoming line segment.</li>
</ul></div>
</div>
<div class="section level2">
<h2 id="features-for-wider-roll-out">features for wider roll-out<a class="anchor" aria-label="anchor" href="#features-for-wider-roll-out"></a></h2>
<div class="section level3">
<h3 id="make-render_venndir-work-for-ggplot2-output">make render_venndir() work for ggplot2 output<a class="anchor" aria-label="anchor" href="#make-render_venndir-work-for-ggplot2-output"></a></h3>
<ul><li>Essentially roll <code>ggrender_venndir()</code> into <code><a href="reference/render_venndir.html">render_venndir()</a></code> then remove <code>ggrender_venndir()</code> (or make it a silent alias.)</li>
<li>Add missing counts text label to ggplot2 output. Plan to use <code><a href="https://wilkelab.org/ggtext/reference/geom_textbox.html" class="external-link">ggtext::geom_textbox()</a></code> for a wider label in ggplot2.</li>
</ul></div>
</div>
<div class="section level2">
<h2 id="miscellaneous-items">Miscellaneous items<a class="anchor" aria-label="anchor" href="#miscellaneous-items"></a></h2>
<div class="section level3">
<h3 id="option-to-place-set-names-at-periphery-of-venn-circles">option to place set names at periphery of Venn circles<a class="anchor" aria-label="anchor" href="#option-to-place-set-names-at-periphery-of-venn-circles"></a></h3>
<ul><li>This change could be most relevant with proportional Venn diagrams especially when one circle is fully enclosed inside another circle.</li>
<li>outer label placement will be necessary when displaying items inside each polygon. Even if I could determine the count label size inside the polygon to place labels around it, it seems non-ideal</li>
<li>this process is different for proportional circles which may be placed at various locations</li>
<li>for Venn circles and ellipses the coordinates could be pre-defined</li>
</ul></div>
<div class="section level3">
<h3 id="improve-item-label-efficiency">improve item label efficiency<a class="anchor" aria-label="anchor" href="#improve-item-label-efficiency"></a></h3>
<ul><li>large number of labels makes it very inefficient – find a way to make it faster.</li>
<li>one idea: instead of calling <code>gridtext</code> for each polygon, aggregate them into a <code>data.frame</code> then display them in one call. Doubtful this change will be much faster.</li>
<li>another idea: the <code><a href="https://rdrr.io/pkg/sp/man/spsample.html" class="external-link">sp::spsample()</a></code> function success rate is fairly low, requiring iterating with higher <code>n + i</code> labels in order to get <code>n</code> coordinates inside the polygon area. This iteration might be rate-limiting with large <code>n</code>.</li>
</ul></div>
<div class="section level3">
<h3 id="make-output-compatible-with-plotly-or-something-interactive">make output compatible with plotly (or something interactive)<a class="anchor" aria-label="anchor" href="#make-output-compatible-with-plotly-or-something-interactive"></a></h3>
<ul><li>Currently <code><a href="https://wilkelab.org/ggtext/reference/geom_richtext.html" class="external-link">ggtext::geom_richtext()</a></code> is not compatible with <code><a href="https://rdrr.io/pkg/plotly/man/ggplotly.html" class="external-link">plotly::ggplotly()</a></code> but probably just lacks the <code>to_basic</code> wrapper function. (See <code><a href="https://rdrr.io/pkg/splicejam/man/to_basic.GeomShape.html" class="external-link">splicejam::to_basic.GeomShape()</a></code> for an example workaround.)</li>
<li>This feature may require text labels at 0 or 90 degrees.</li>
</ul></div>
<div class="section level3">
<h3 id="venn-meme-function">venn meme function<a class="anchor" aria-label="anchor" href="#venn-meme-function"></a></h3>
<ul><li>basic idea is to make it “easy” to create a Venn meme when needed. The ability is already in place, but seems to have very consistently different default values than other Venn styles.</li>
</ul></div>
<div class="section level3">
<h3 id="example-of-displaying-items-in-large-label-box-beside-the-venn-diagram">example of displaying items in large label box beside the Venn diagram<a class="anchor" aria-label="anchor" href="#example-of-displaying-items-in-large-label-box-beside-the-venn-diagram"></a></h3>
<ul><li>manual placement of a larger label block where it handles word-wrapping itself, done by <code>gridtext</code>.</li>
</ul></div>
<div class="section level3">
<h3 id="display-fully-closed-venn-counts">display fully “closed” Venn counts<a class="anchor" aria-label="anchor" href="#display-fully-closed-venn-counts"></a></h3>
<ul><li>
<p>“Closed” includes the universe of each input list which is not represented in the Venn circles. For example:</p>
<ul><li>genes tested in set_A that are not hits</li>
<li>genes tested in set_B that are not hits</li>
</ul></li>
<li><p>This option is based upon <code>limma</code> package display of total genes in each set, displayed outside the main Venn circles.</p></li>
</ul></div>
<div class="section level3">
<h3 id="item-labels">item labels<a class="anchor" aria-label="anchor" href="#item-labels"></a></h3>
<ul><li>
<p>It still sometimes fails to find enough labels inside the polygon, usually for large number of labels. Workaround might be for the user to change layout type to something like <code>"regular"</code> or <code>"nonaligned"</code> which could improve the search success rate.</p>
<ul><li>Add example to help text, and to Rmarkdown vignette.</li>
</ul></li>
<li>
<p>DONE: When there is only one item, consider using the center label instead of choosing a location inside the polygon, which sometimes chooses something away from the center.</p>
<ul><li>Note that sometimes the <code><a href="https://jolars.github.io/polylabelr//reference/poi.html" class="external-link">polylabelr::poi()</a></code> point is outside the polygon, which happens sometimes when the polygon has a hole or otherwise “weird” shape. The method checks for that and uses the buffer polygon <code><a href="https://rdrr.io/pkg/sp/man/spsample.html" class="external-link">sp::spsample()</a></code> approach if the <code><a href="https://jolars.github.io/polylabelr//reference/poi.html" class="external-link">polylabelr::poi()</a></code> point is not contained in the source polygon.</li>
</ul></li>
</ul></div>
<div class="section level3">
<h3 id="label_polygon_fill-with-relative-buffer-scale_width">
<code>label_polygon_fill()</code> with relative buffer scale_width<a class="anchor" aria-label="anchor" href="#label_polygon_fill-with-relative-buffer-scale_width"></a></h3>
<ul><li>
<p>add option for scale_width to be relative to the object size instead of absolute dimensions. For example:</p>
<ul><li>
<code>scale_width=-1</code> would produce no output polygon, because <code>-1</code> is interpreted <code>-100%</code>,</li>
<li>
<code>scale_width=-0.99</code> would produce an extremely small polygon, roughly 1% the original width,</li>
<li>
<code>scale_width=-0.5</code> would produce a polygon with roughly half width buffer.</li>
</ul></li>
<li><p>The test example should use a relatively tall-thin ellipse, rotated to 45 degrees. The bounding box would be quite large, but the actual width of the polygon would be relatively small.</p></li>
</ul></div>
<div class="section level3">
<h3 id="label_polygon_fill-extra-features">
<code>label_polygon_fill()</code> extra features<a class="anchor" aria-label="anchor" href="#label_polygon_fill-extra-features"></a></h3>
<ul><li>DONE: dither_cex,dither_color,dither_angle to adjust each text label slightly in three ways: <code>cex</code> to make label font slightly larger or smaller; <code>color</code> to make label color slightly lighter or darker; <code>angle</code> to adjust the angle of text slightly more or less than the original <code>angle</code> value. These effects can help visibly distinguish large number of labels packed into a relatively small polygon area.</li>
</ul></div>
<div class="section level3">
<h3 id="missing-counts-warning">missing counts warning<a class="anchor" aria-label="anchor" href="#missing-counts-warning"></a></h3>
<ul><li>DONE: The warning needs to check both <code>show_label</code> and <code>show_items</code> for each overlap set before deciding that a set is not displayed.</li>
</ul></div>
<div class="section level3">
<h3 id="consider-refactoring-base-r-plot-to-use-grid-graphics">consider refactoring “base R plot” to use “grid graphics”<a class="anchor" aria-label="anchor" href="#consider-refactoring-base-r-plot-to-use-grid-graphics"></a></h3>
<ul><li>Lower priority evaluation.</li>
<li>Requires learning grid graphics in much more detail.</li>
<li>The main benefit would be compatibility with <code><a href="https://wilkelab.org/gridtext/reference/richtext_grob.html" class="external-link">gridtext::richtext_grob()</a></code> which uses grid graphics. Currently using <code>gridBase</code> to combine <code>grid</code> and base R plotting works in interactive R sessions, but in Rmarkdown it is sometimes glitchy, because Rmarkdown now calls <code><a href="https://ragg.r-lib.org/reference/agg_png.html" class="external-link">ragg::agg_png()</a></code> and I’m almost sure this use would not be recommended or supported. “Pick one method” is a reasonable thing to ask of me.</li>
<li>Another benefit is potential to calculate label width in a way to detect overlaps, and/or resize font size to fit relative to other labels.</li>
<li>Another possibility is to re-position labels using relative units, for example move main/signed labels to the left by 1.2x main label width.</li>
</ul></div>
<div class="section level3">
<h3 id="refactor-venn-count-label-styling">refactor venn count label styling<a class="anchor" aria-label="anchor" href="#refactor-venn-count-label-styling"></a></h3>
<ul><li>
<p>DONE: <code><a href="reference/venndir_label_style.html">venndir_label_style()</a></code></p>
<ul><li>currently resides inside <code><a href="reference/venndir.html">venndir()</a></code> which makes it hard to change the style in <code><a href="reference/render_venndir.html">render_venndir()</a></code>. I guess ideally the count label style can be updated by a separate function to make it easy to change styles.</li>
</ul></li>
</ul></div>
<div class="section level3">
<h3 id="calculate-concordance-coefficient">calculate concordance coefficient<a class="anchor" aria-label="anchor" href="#calculate-concordance-coefficient"></a></h3>
<ul><li>Kruskal concordance: (agree - disagree) / (agree + disagree)</li>
<li>Return concordance for each overlap set</li>
</ul></div>
</div>
<div class="section level2">
<h2 id="completed-items">Completed items<a class="anchor" aria-label="anchor" href="#completed-items"></a></h2>
<div class="section level3">
<h3 id="done-option-to-move-count-labels-outside-the-polygon">DONE: option to move count labels outside the polygon<a class="anchor" aria-label="anchor" href="#done-option-to-move-count-labels-outside-the-polygon"></a></h3>
<ul><li>
<p>DONE: implement <code>x_offset,y_offset</code> for count labels</p>
<ul><li>Draw a line to polygon border if needed (<code><a href="reference/polygon_label_segment.html">polygon_label_segment()</a></code>)</li>
</ul></li>
</ul></div>
<div class="section level3">
<h3 id="done-refactor-venndir-output">DONE: refactor venndir output<a class="anchor" aria-label="anchor" href="#done-refactor-venndir-output"></a></h3>
<p>The changes below are DONE.</p>
<ul><li>
<p>each polygon is represented per row in <code>venn_spdf</code></p>
<ul><li>label (set overlap)</li>
<li>venn_counts</li>
<li>count label x,y coordinates</li>
<li>count label x_offset,y_offset to displace a label outside the polygon (actually the offset will be stored in <code>label_df</code> for each label)</li>
<li>polygon fill, border</li>
<li>alpha, lwd, lty</li>
</ul></li>
<li>
<p>each label is represented in label_df, sometimes multiple labels per polygon</p>
<ul><li><p>venn_counts</p></li>
<li><p>text (visible label)</p></li>
<li><p>overlap_set (matches venn_spdf$label)</p></li>
<li><p>type (main for total counts, signed for directional counts)</p></li>
<li><p>x,y coordinates for each label (they should move together but not required)</p></li>
<li><p>x_offset,y_offset for each label (make sure to draw each unique line only once)</p></li>
<li><p>col (label text color), fill (label box fill), border (label box border)</p></li>
<li><p>fontsize, vjust, hjust, halign, rot</p></li>
<li><p>show_label - whether to display <code>text</code> for this polygon</p></li>
<li><p>show_items - whether to display <code>items</code> for this polygon</p></li>
<li>
<p>show_label and show_items are intended to be mutually exclusive per polygon, default behavior:</p>
<ul><li>default <code>show_label=NA</code> and <code>show_items=NA</code> each row of <code>label_df</code>
</li>
<li>function argument decides behavior for rows with <code>NA</code>.</li>
<li>if any <code>show_label=TRUE</code> for a polygon in <code>label_df</code> then set <code>show_items=FALSE</code>, or in future move the label outside the polygon.</li>
<li>if <code>show_items=TRUE</code> then if <code>length(items) &gt; max_items</code> then set <code>show_items=FALSE</code> and <code>show_label=TRUE</code>.</li>
<li>if both <code>show_labels=TRUE</code> and <code>show_items=TRUE</code> then display both, trust the user to adjust coordinates as needed.</li>
</ul></li>
</ul></li>
</ul></div>
</div>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>

</div>



      <footer><div class="copyright">
  <p></p><p>Developed by James M. Ward.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

